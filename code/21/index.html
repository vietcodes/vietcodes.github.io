<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <title> VOI 2011 UPGRANET - Nâng cấp mạng - VietCodes </title>
        <link rel="shortcut icon" type="image/x-icon" href="/favicon.png" /> 
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu+Mono">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="/css/all.css">
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML' defer></script>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <script>
(adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-2911647956237293",
    enable_page_level_ads: true
});
        </script>
    </head>

    <body>
        <p class="brand">
<span class="host">Guest@</span><a href="/" class="host">vietcodes</a>:<span class="pwd">/</span>$ ls
</p>
<nav class="navbar">
  <div class="container-fluid">
    <ul class="nav navbar-nav">
      <li><a class="pwd" href="/algorithms">Algorithms</a></li>
      <li><a class="pwd" href="/codehub">CodeHub</a></li>
    </ul>
  </div>
</nav>

        <div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="panel window" style="margin-bottom: 0.5em;">
                <div class="panel-heading">
                    <img class="btn-close" src="/img/close.svg"><img class="btn-minimize" src="/img/minimize.svg"><img class="btn-maximize" src="/img/maximize.svg">
                    <span class="title">Quảng cáo</span>
                </div>
                <div style="padding-bottom: 0.5em; padding-top: 0.5em;" class="panel-body content">
                    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <!-- ad-0 -->
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-2911647956237293"
                         data-ad-slot="4249876710"
                         data-ad-format="auto"></ins>
                    <script>
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
            </div>

            <div class="panel window" style="margin-bottom: 0.5em;" id="overview">
                <div class="panel-heading">
                    <img class="btn-close" src="/img/close.svg"><img class="btn-minimize" src="/img/minimize.svg"><img class="btn-maximize" src="/img/maximize.svg">
                    <span class="title">Overview</span>
                </div>
                <div style="padding-bottom: 0.5em; padding-top: 0.5em;" class="panel-body content">
                    <h3 id="voi-2011-upgranet---nâng-cấp-mạng">VOI 2011 UPGRANET - Nâng cấp mạng</h3>
<ul>
  <li>Đề bài: <a href="http://vnoi.info/problems/show/UPGRANET/" target="_blank">http://vnoi.info/problems/show/UPGRANET/</a></li>
  <li>Keywords: graph, mst, disjoint set, kruskal, heavy-light decomposition, lca, fenwick tree</li>
  <li>Tài liệu:
    <ul>
      <li><a href="https://en.wikipedia.org/wiki/Kruskal's_algorithm" target="blank">https://en.wikipedia.org/wiki/Kruskal’s_algorithm</a></li>
      <li><a href="https://en.wikipedia.org/wiki/Disjoint_sets" target="blank">https://en.wikipedia.org/wiki/Disjoint_sets</a></li>
      <li><a href="http://vnoi.info/wiki/algo/data-structures/heavy-light-decomposition" target="blank">http://vnoi.info/wiki/algo/data-structures/heavy-light-decomposition</a></li>
      <li><a href="http://vnoi.info/wiki/algo/data-structures/lca#cách-4-heavy-light-decomposition" target="blank">http://vnoi.info/wiki/algo/data-structures/lca#cách-4-heavy-light-decomposition</a></li>
    </ul>
  </li>
  <li>Ngôn ngữ: C++11</li>
</ul>

                </div>
            </div>

            
            <div class="panel window" style="margin-bottom: 0.5em;" id="solution.md">
                <div class="panel-heading">
                    <img class="btn-close" src="/img/close.svg"><img class="btn-minimize" src="/img/minimize.svg"><img class="btn-maximize" src="/img/maximize.svg">
                    <span class="title">solution.md</span>
                </div>
                <div style="margin-top: 0;" class="panel-body content">
                    <p>Ta thấy đường đi có thông lượng lớn nhất giữa 2 máy chính là đường đi
trên cây khung lớn nhất.</p>

<p>Vì vậy, bài này ta cần tìm cây khung lớn nhất, sau đó với mỗi cạnh
(u,v) không thuộc cây khung, ta tìm trọng số nhỏ nhất trên đường đi
từ u đến v trong cây khung. Để không bị quá thời gian, ta có thể dùng
heavy-light decomposition và binary indexed tree hoặc segment tree để
tìm LCA và tìm min trên đường đi.</p>

                </div>
            </div>
            

            
            <div class="panel window" style="margin-bottom: 0.5em;" id="main.cpp">
                <div class="panel-heading">
                    <img class="btn-close" src="/img/close.svg"><img class="btn-minimize" src="/img/minimize.svg"><img class="btn-maximize" src="/img/maximize.svg">
                    <span class="title">main.cpp</span>
                </div>
                <div style="margin-top: 0;" class="panel-body content">
                    <a href="https://github.com/vietcodes/vietcodes.github.io/blob/master/code/21/main.cpp">Open in Github <i class="fa fa-lg fa-github"></i></a>
                    &bull;
                    <a href="main.cpp">Download <i class="fa fa-lg fa-download"></i></a>

                    <table width="100%" style="margin-top:.5em;">
                        <tr>
                            <td>
                                <pre style="text-align:right; word-break:keep-all; border-right:0; padding-right:4px;"><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</code></pre>
                            </td>
                            <td width="100%">
                                
<div class="language-c++ selectable-code highlighter-rouge" contenteditable="true"><pre class="highlight"><code><span class="cp">#include &lt;vector&gt;
#include &lt;algorithm&gt;
#include &lt;iostream&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="cp">#define LL long long
</span><span class="k">struct</span> <span class="n">pack</span><span class="p">{</span> <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span> <span class="p">};</span>
<span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">dsk</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">universe</span> <span class="p">{</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cha</span><span class="p">,</span> <span class="n">rank</span><span class="p">;</span>
    <span class="n">universe</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span><span class="o">:</span> <span class="n">cha</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rank</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">cha</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">find</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cha</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">!=</span> <span class="n">u</span><span class="p">)</span> <span class="n">cha</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">cha</span><span class="p">[</span><span class="n">u</span><span class="p">]);</span>
        <span class="k">return</span> <span class="n">cha</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="kt">bool</span> <span class="n">join</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rank</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">rank</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="n">rank</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rank</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rank</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="n">cha</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">cha</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">minimize</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Hld</span> <span class="p">{</span>
    <span class="n">dsk</span> <span class="n">ke</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">nChild</span><span class="p">,</span> <span class="n">cha</span><span class="p">,</span> <span class="n">bac</span><span class="p">,</span> <span class="n">chainHead</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">pos</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">w</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">Hld</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">dsk</span> <span class="o">&amp;&amp;</span><span class="n">ke</span><span class="p">)</span><span class="o">:</span> <span class="n">ke</span><span class="p">(</span><span class="n">ke</span><span class="p">),</span>
    <span class="n">nChild</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cha</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bac</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">chainHead</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">chain</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">pos</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">),</span> <span class="n">r</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">),</span> <span class="n">w</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">),</span> <span class="n">n</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">prepare</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">nChain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">hld</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nChain</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">prepare</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">nChild</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ke</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">nChild</span><span class="p">[</span><span class="n">ke</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span> <span class="p">{</span>
            <span class="n">ke</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ke</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">back</span><span class="p">();</span>
            <span class="n">ke</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">pop_back</span><span class="p">();</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">v</span><span class="o">:</span> <span class="n">ke</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">cha</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
            <span class="n">bac</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">bac</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">nChild</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">prepare</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">nChild</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">hld</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">nChain</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">count</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chainHead</span><span class="p">[</span><span class="n">nChain</span><span class="p">])</span> <span class="n">chainHead</span><span class="p">[</span><span class="n">nChain</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
        <span class="n">chain</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">nChain</span><span class="p">;</span>
        <span class="n">pos</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="n">count</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">con</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">v</span><span class="o">:</span> <span class="n">ke</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">con</span> <span class="o">||</span> <span class="n">nChild</span><span class="p">[</span><span class="n">con</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">nChild</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="n">con</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">con</span><span class="p">)</span> <span class="n">hld</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">nChain</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">v</span><span class="o">:</span> <span class="n">ke</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">con</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">nChain</span><span class="o">++</span><span class="p">;</span>
            <span class="n">chainHead</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="n">hld</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">nChain</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">bitUp</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">)</span> <span class="n">minimize</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">bitGet</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="n">v</span><span class="p">)</span> <span class="n">swap</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
        <span class="n">u</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">u</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">v</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">v</span><span class="p">)))</span> <span class="p">{</span>
                <span class="n">minimize</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">v</span><span class="p">]);</span>
                <span class="n">v</span> <span class="o">-=</span> <span class="n">v</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">v</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">minimize</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="n">v</span><span class="p">]);</span>
                <span class="n">v</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chain</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">!=</span> <span class="n">chain</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cha</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span> <span class="n">w</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
            <span class="k">else</span> <span class="n">w</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cha</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span> <span class="n">bitUp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="n">u</span><span class="p">]);</span>
            <span class="k">else</span> <span class="n">bitUp</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">pos</span><span class="p">[</span><span class="n">v</span><span class="p">]);</span>
        <span class="p">}</span> 
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">query</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">chain</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">!=</span> <span class="n">chain</span><span class="p">[</span><span class="n">v</span><span class="p">])</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">hu</span> <span class="o">=</span> <span class="n">chainHead</span><span class="p">[</span><span class="n">chain</span><span class="p">[</span><span class="n">u</span><span class="p">]],</span> <span class="n">hv</span> <span class="o">=</span> <span class="n">chainHead</span><span class="p">[</span><span class="n">chain</span><span class="p">[</span><span class="n">v</span><span class="p">]];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">bac</span><span class="p">[</span><span class="n">hu</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bac</span><span class="p">[</span><span class="n">hv</span><span class="p">])</span> <span class="n">swap</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">swap</span><span class="p">(</span><span class="n">hu</span><span class="p">,</span> <span class="n">hv</span><span class="p">);</span>
            <span class="n">minimize</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">bitGet</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="n">hv</span><span class="p">]));</span>
            <span class="n">minimize</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">w</span><span class="p">[</span><span class="n">hv</span><span class="p">]);</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">cha</span><span class="p">[</span><span class="n">hv</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">minimize</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">bitGet</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="n">v</span><span class="p">]));</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span> <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">;</span> <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="n">m</span><span class="p">;</span>
    <span class="n">universe</span> <span class="n">s</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">pack</span><span class="o">&gt;</span> <span class="n">edges</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="n">e</span><span class="o">:</span> <span class="n">edges</span><span class="p">)</span> <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">u</span> <span class="o">&gt;&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">c</span><span class="p">;</span>
    <span class="n">sort</span><span class="p">(</span><span class="n">edges</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">edges</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[](</span><span class="n">pack</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="n">pack</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">){</span><span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">c</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">.</span><span class="n">c</span><span class="p">;});</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">pack</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">tree</span><span class="p">;</span>
    <span class="n">dsk</span> <span class="n">ke</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="n">e</span><span class="o">:</span> <span class="n">edges</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">u</span><span class="p">),</span> <span class="n">s</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">)))</span> <span class="p">{</span>
            <span class="n">ke</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">u</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">);</span>
            <span class="n">ke</span><span class="p">[</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">u</span><span class="p">);</span>
            <span class="n">tree</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Hld</span> <span class="n">hld</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">move</span><span class="p">(</span><span class="n">ke</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="n">x</span><span class="o">:</span> <span class="n">tree</span><span class="p">)</span> <span class="n">hld</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>
    <span class="n">LL</span> <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="n">q</span><span class="o">:</span> <span class="n">q</span><span class="p">)</span> <span class="n">res</span> <span class="o">+=</span> <span class="p">(</span><span class="n">LL</span><span class="p">)(</span><span class="n">hld</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">u</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">res</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            
        </div>
    </div>
    <button onclick="loadComments()" class="btn btn-lg btn-success btn-block btn-load-cmt" id="btn-load-cmt">Load comments</button>
<div class="panel window hide" id="disqus-window">
    <div class="panel-heading">
        <img class="btn-close" src="/img/close.svg"><img class="btn-minimize" src="/img/minimize.svg"><img class="btn-maximize" src="/img/maximize.svg">
        <span class="title">Comments</span>
    </div>
    <div class="panel-body" id="disqus_thread">
    </div>
</div>

<script>
var disqus_config = function () {
    this.page.url = "https://vietcodes.github.io/code/21/";
    this.page.identifier = "https://vietcodes.github.io/code/21/";
};
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>

<script src="/js/codeview.js"></script>

        <footer class="page-footer">
    <div class="footer-copyright">
        <div class="container-fluid">
            &copy; 2017 VietCodes
        </div>
    </div>
</footer>

        <script src="/js/all.js" defer></script>
    </body>
</html>
